"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8126],{8126(d1,P,d){d.d(P,{WorkbookPageModule:()=>l1});var B,M=d(2200),D=d(4341),R=d(7343),V=d(8132),f=d(467),p=d(6299),S=function(a,n){var l=function(){if(typeof window>"u")return new Map;if(!B){var a=window;a.Ionicons=a.Ionicons||{},B=a.Ionicons.map=a.Ionicons.map||new Map}return B}(),o=l.get(a);void 0===o?l.set(a,n):o!==n&&console.warn('[Ionicons Warning]: Multiple icons were mapped to name "'.concat(a,'". Ensure that multiple icons are not mapped to the same icon name.'))},s=d(3664),r=d(2615),j=d(4185);let W=(()=>{var a;class n{constructor(o){this.cardsService=o,this.API_URL="https://inputtools.google.com/request?itc=ja-t-i0-handwrit&app=translate"}recognize(o,i,t){var c=this;return(0,f.A)(function*(){if(0===o.length)return[];const g=o.map(h=>{const e=[],w=[],m=[];for(const x of h)e.push(Math.round(x.x)),w.push(Math.round(x.y)),m.push(x.t);return[e,w,m]}),v={app_version:.4,api_level:"537.36",device:navigator.userAgent,input_type:0,options:"enable_pre_space",requests:[{max_completions:0,max_num_results:10,pre_context:"",writing_guide:{writing_area_height:t,writing_area_width:i},ink:g}]};try{const e=yield(yield fetch(c.API_URL,{method:"POST",body:JSON.stringify(v),headers:{"Content-Type":"application/json"}})).json();return c.parseResponse(e)}catch(h){throw console.error("Recognition failed:",h),new Error("Handwriting recognition failed. Please check your internet connection.")}})()}parseResponse(o){if(!o||"SUCCESS"!==o[0])return[];const i=o[1]?.[0]?.[1];return i&&0!==i.length?i.map((t,c)=>({character:t.replace(/\s+/g,""),score:Math.max(100-10*c,10)})):[]}getExpectedStrokeCount(o){return this.cardsService.getStrokeCount(o)}static#o=a=()=>(this.\u0275fac=function(i){return new(i||n)(r.KVO(j.D))},this.\u0275prov=r.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}))}return a(),n})();const N=["canvas"];function G(a,n){1&a&&s.nrm(0,"canvas",11,0)}function $(a,n){if(1&a){const l=s.RV6();s.j41(0,"ion-button",12),s.bIt("click",function(){r.eBV(l);const i=s.XpG();return r.Njj(i.onUndo())}),s.nrm(1,"ion-icon",13),s.k0s()}}function Y(a,n){1&a&&(s.j41(0,"div",14)(1,"div",15),s.EFF(2,"\u304a\u3081\u3067\u3068\u3046\u{1f973}"),s.k0s(),s.j41(3,"div",16),s.EFF(4,"You're all caught up. Come back again soon for more lessons!"),s.k0s()())}function X(a,n){1&a&&s.nrm(0,"ion-spinner",20)}function J(a,n){if(1&a&&(s.j41(0,"span"),s.EFF(1),s.k0s()),2&a){const l=s.XpG(2);s.R7$(),s.JRh(l.checkButtonText)}}function Q(a,n){if(1&a){const l=s.RV6();s.j41(0,"ion-button",17),s.bIt("click",function(){r.eBV(l);const i=s.XpG();return r.Njj(i.onCheck())}),s.DNE(1,X,1,0,"ion-spinner",18)(2,J,2,1,"span",19),s.k0s()}if(2&a){const l=s.XpG();s.Y8G("disabled",l.isChecking),s.R7$(),s.Y8G("ngIf",l.isChecking),s.R7$(),s.Y8G("ngIf",!l.isChecking)}}function Z(a,n){1&a&&(s.j41(0,"span"),s.EFF(1,"\u25ef"),s.k0s())}function K(a,n){1&a&&(s.j41(0,"span"),s.EFF(1,"\uff1f"),s.k0s())}function o1(a,n){1&a&&(s.j41(0,"span"),s.EFF(1,"\u2715"),s.k0s())}function s1(a,n){if(1&a&&(s.j41(0,"div",32)(1,"span",33),s.EFF(2),s.k0s()()),2&a){const l=n.$implicit;s.R7$(2),s.JRh(l.character)}}function a1(a,n){if(1&a&&(s.j41(0,"div",28)(1,"div",29),s.EFF(2,"Recognized:"),s.k0s(),s.j41(3,"div",30),s.DNE(4,s1,3,1,"div",31),s.k0s()()),2&a){const l=s.XpG(2);s.R7$(4),s.Y8G("ngForOf",l.displayMatches)}}function i1(a,n){if(1&a){const l=s.RV6();s.j41(0,"div",21),s.bIt("click",function(){r.eBV(l);const i=s.XpG();return r.Njj(i.dismissResults())}),s.j41(1,"div",22),s.bIt("click",function(i){return r.eBV(l),r.Njj(i.stopPropagation())}),s.j41(2,"div",23),s.DNE(3,Z,2,0,"span",19)(4,K,2,0,"span",19)(5,o1,2,0,"span",19),s.k0s(),s.j41(6,"div",24),s.EFF(7),s.k0s(),s.j41(8,"div",25),s.EFF(9),s.k0s(),s.DNE(10,a1,5,1,"div",26),s.j41(11,"ion-button",27),s.bIt("click",function(){r.eBV(l);const i=s.XpG();return r.Njj(i.dismissResults())}),s.EFF(12),s.k0s()()()}if(2&a){const l=s.XpG();s.R7$(),s.HbH(l.resultStatus),s.R7$(2),s.Y8G("ngIf","correct"===l.resultStatus),s.R7$(),s.Y8G("ngIf","befuddled"===l.resultStatus),s.R7$(),s.Y8G("ngIf","wrong"===l.resultStatus),s.R7$(2),s.JRh(l.resultFeedback),s.R7$(2),s.JRh(l.strokeCountInfo),s.R7$(),s.Y8G("ngIf",l.displayMatches.length>0),s.R7$(2),s.JRh(l.dismissButtonText)}}let O=(()=>{var a;class n{constructor(o,i){this.strokeRecognition=o,this.cardsService=i,this.isDrawing=!1,this.strokes=[],this.currentStroke=[],this.drawStartTime=0,this.currentCharacter="",this.promptText="",this.promptColor="#FFFFFF",this.noCardsAvailable=!1,this.isChecking=!1,this.showResults=!1,this.resultStatus="",this.resultFeedback="",this.strokeCountInfo="",this.topMatches=[],this.displayMatches=[],this.cardAvailabilitySubscription=null,this.correctFeedback=["\u6b63\u89e3!","\u307e\u308b!","\u306f\u306a\u307e\u308b!","\u3088\u304f\u3084\u3063\u305f!","\u3059\u3054\u3044!","\u304b\u3093\u307a\u304d!","\u3070\u3063\u3061\u308a!","\u305d\u306e\u8abf\u5b50!"],this.wrongFeedback=["\u3061\u304c\u3046!","\u3056\u3093\u306d\u3093!","\u306f\u305a\u308c!","\u3075\u305b\u3044\u304b\u3044!","\u30d0\u30c4!"],this.checkButtonLabels=["\u3088\u3057!","\u5224\u5b9a!","\u3067\u304d\u305f!","\u3044\u3056!","\u78ba\u8a8d"],this.dismissButtonLabels=["\u6b21!","\u3064\u304e!","\u3088\u3057!","\u30aa\u30c3\u30b1\u30fc!","\u306f\u3044!","\u4e86\u89e3!","\u3044\u304f\u305e!"],this.checkButtonText="",this.dismissButtonText="",this.minBrushSize=4,this.maxBrushSize=32,this.brushSmoothing=.05,this.lastBrushSize=0,function(a){Object.keys(a).forEach(function(n){S(n,a[n]);var l=n.replace(/([a-z0-9]|(?=[A-Z]))([A-Z0-9])/g,"$1-$2").toLowerCase();n!==l&&S(l,a[n])})}({backspace:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M403.13 96H156.87a44.9 44.9 0 00-33.68 15.27 15.88 15.88 0 00-1.91 2.7L32 247.75a16 16 0 000 16.5l89.15 133.57a16.24 16.24 0 002 2.88 44.89 44.89 0 0033.7 15.3h246.28A44.92 44.92 0 00448 371.13V140.87A44.92 44.92 0 00403.13 96zM348 311a16 16 0 11-22.63 22.62L271.67 280 218 333.65A16 16 0 01195.35 311L249 257.33l-53.69-53.69A16 16 0 01218 181l53.69 53.7 53.67-53.7A16 16 0 01348 203.64l-53.7 53.69z'/></svg>"})}ngOnInit(){var o=this;return(0,f.A)(function*(){o.checkButtonText=o.randomFrom(o.checkButtonLabels),yield o.cardsService.initialize(),o.loadRandomCard(),o.cardAvailabilitySubscription=o.cardsService.cardAvailability$.subscribe(i=>{o.noCardsAvailable&&i>0&&o.loadRandomCard()})})()}loadRandomCard(){this.currentCard=this.cardsService.getRandomUnlockedCard(),this.currentCard?(this.currentCharacter=this.currentCard.answer,this.promptText=this.currentCard.prompt,this.promptColor=this.cardsService.getStageColor(this.currentCard.stage),this.noCardsAvailable=!1):(this.noCardsAvailable=!0,this.promptText="",this.promptColor="#FFFFFF")}ngAfterViewInit(){setTimeout(()=>this.setupCanvas(),100)}ngOnDestroy(){this.resizeObserver&&this.resizeObserver.disconnect(),this.cardAvailabilitySubscription&&this.cardAvailabilitySubscription.unsubscribe()}setupCanvas(){const o=this.canvasRef.nativeElement,i=o.parentElement;i&&(this.resizeCanvas(),this.resizeObserver=new ResizeObserver(()=>this.resizeCanvas()),this.resizeObserver.observe(i),this.ctx=o.getContext("2d"),this.setCanvasStyle(),o.addEventListener("mousedown",this.handleMouseDown.bind(this)),o.addEventListener("mousemove",this.handleMouseMove.bind(this)),o.addEventListener("mouseup",this.handleMouseUp.bind(this)),o.addEventListener("mouseleave",this.handleMouseUp.bind(this)),o.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),o.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),o.addEventListener("touchend",this.handleTouchEnd.bind(this)))}resizeCanvas(){const o=this.canvasRef.nativeElement,i=o.parentElement;i&&(o.width=i.clientWidth,o.height=i.clientHeight,this.ctx&&this.setCanvasStyle())}setCanvasStyle(){this.ctx.fillStyle="#fff",this.ctx.strokeStyle="#fff",this.ctx.lineCap="round",this.ctx.lineJoin="round"}handleMouseDown(o){this.isDrawing=!0;const i=this.getMousePos(o);this.currentStroke=[i],this.lastBrushSize=(this.minBrushSize+this.maxBrushSize)/2,this.drawBrushPoint(i.x,i.y,1.5*this.minBrushSize)}handleMouseMove(o){if(!this.isDrawing)return;const i=this.getMousePos(o),t=this.currentStroke[this.currentStroke.length-1];this.currentStroke.push(i),this.drawBrushSegment(t,i)}handleMouseUp(){this.isDrawing&&this.currentStroke.length>0&&(this.drawHarai(this.currentStroke),this.strokes.push([...this.currentStroke]),this.currentStroke=[]),this.isDrawing=!1}handleTouchStart(o){o.preventDefault(),this.isDrawing=!0;const i=this.getTouchPos(o);this.currentStroke=[i],this.lastBrushSize=(this.minBrushSize+this.maxBrushSize)/2,this.drawBrushPoint(i.x,i.y,1.5*this.minBrushSize)}handleTouchMove(o){if(!this.isDrawing)return;o.preventDefault();const i=this.getTouchPos(o),t=this.currentStroke[this.currentStroke.length-1];this.currentStroke.push(i),this.drawBrushSegment(t,i)}handleTouchEnd(){this.isDrawing&&this.currentStroke.length>0&&(this.drawHarai(this.currentStroke),this.strokes.push([...this.currentStroke]),this.currentStroke=[]),this.isDrawing=!1}getMousePos(o){const i=this.canvasRef.nativeElement,t=i.getBoundingClientRect(),c=i.width/t.width,g=i.height/t.height,v=Date.now();return 0===this.drawStartTime&&(this.drawStartTime=v),{x:(o.clientX-t.left)*c,y:(o.clientY-t.top)*g,t:v-this.drawStartTime}}getTouchPos(o){const i=this.canvasRef.nativeElement,t=i.getBoundingClientRect(),c=i.width/t.width,g=i.height/t.height,v=Date.now();return 0===this.drawStartTime&&(this.drawStartTime=v),{x:(o.touches[0].clientX-t.left)*c,y:(o.touches[0].clientY-t.top)*g,t:v-this.drawStartTime}}calculateBrushSize(o,i){const t=i.x-o.x,c=i.y-o.y,g=Math.max(i.t-o.t,1),h=Math.sqrt(t*t+c*c)/g,e=Math.min(h/1.5,1),m=this.lastBrushSize+(this.maxBrushSize-e*(this.maxBrushSize-this.minBrushSize)-this.lastBrushSize)*this.brushSmoothing;return this.lastBrushSize=m,m}drawBrushPoint(o,i,t){this.ctx.beginPath(),this.ctx.arc(o,i,t/2,0,2*Math.PI),this.ctx.fill()}drawBrushSegment(o,i){const t=this.calculateBrushSize(o,i);this.ctx.lineWidth=t,this.ctx.beginPath(),this.ctx.moveTo(o.x,o.y),this.ctx.lineTo(i.x,i.y),this.ctx.stroke(),this.drawBrushPoint(i.x,i.y,t)}drawHarai(o){if(o.length<3)return;const i=Math.min(5,o.length),t=o.slice(-i),c=t[t.length-1],g=t[0],v=c.x-g.x,h=c.y-g.y,e=Math.sqrt(v*v+h*h);if(e<5)return;const w=v/e,m=h/e,x=Math.max(c.t-g.t,1),u=Math.min(e/x*20,40);if(u<8)return;const e1=this.lastBrushSize;for(let k=0;k<8;k++){const b=(k+1)/8,q=1-Math.pow(1-k/8,2),_=1-Math.pow(1-b,2),r1=c.x+w*u*q,g1=c.y+m*u*q,h1=c.x+w*u*_,w1=c.y+m*u*_,F=e1*(1-b);F>.5&&(this.ctx.lineWidth=F,this.ctx.beginPath(),this.ctx.moveTo(r1,g1),this.ctx.lineTo(h1,w1),this.ctx.stroke())}}onCheck(){var o=this;return(0,f.A)(function*(){if(0!==o.strokes.length&&o.currentCard){o.isChecking=!0;try{const i=o.canvasRef.nativeElement,t=yield o.strokeRecognition.recognize(o.strokes,i.width,i.height);o.topMatches=t.slice(0,5);const c=o.topMatches.map(e=>e.character),g=o.currentCharacter.replace(/\s+/g,""),v=c.indexOf(g);if(v>=0&&v<5)o.resultStatus="correct",o.resultFeedback=o.randomFrom(o.correctFeedback),o.displayMatches=o.topMatches.slice(0,v+1),o.cardsService.advanceCard(o.currentCard.id);else{const e=o.currentCard.befuddlers.find(w=>c.includes(w.answer.replace(/\s+/g,"")));if(e){o.resultStatus="befuddled",o.resultFeedback=e.toast;const w=e.answer.replace(/\s+/g,""),m=c.indexOf(w);o.displayMatches=o.topMatches.slice(0,m+1)}else o.resultStatus="wrong",o.resultFeedback=o.randomFrom(o.wrongFeedback),o.displayMatches=o.topMatches}const h=o.strokeRecognition.getExpectedStrokeCount(o.currentCharacter);o.strokeCountInfo=`Strokes: ${o.strokes.length}/${h}`}catch(i){console.error("Recognition error:",i),o.resultStatus="wrong",o.resultFeedback=i.message||"Recognition failed. Please try on a device.",o.topMatches=[],o.displayMatches=[],o.strokeCountInfo=""}o.isChecking=!1,o.checkButtonText=o.randomFrom(o.checkButtonLabels),o.dismissButtonText=o.randomFrom(o.dismissButtonLabels),o.showResults=!0}})()}dismissResults(){this.showResults=!1,this.clearCanvas(),("correct"===this.resultStatus||"wrong"===this.resultStatus)&&this.loadRandomCard()}onUndo(){this.strokes.length>0&&(this.strokes.pop(),this.redrawStrokes())}redrawStrokes(){const o=this.canvasRef.nativeElement;this.ctx.clearRect(0,0,o.width,o.height),this.setCanvasStyle();for(const i of this.strokes)if(0!==i.length){this.lastBrushSize=(this.minBrushSize+this.maxBrushSize)/2,this.drawBrushPoint(i[0].x,i[0].y,1.5*this.minBrushSize);for(let t=1;t<i.length;t++)this.drawBrushSegment(i[t-1],i[t]);this.drawHarai(i)}}clearCanvas(){const o=this.canvasRef.nativeElement;this.ctx.clearRect(0,0,o.width,o.height),this.strokes=[],this.drawStartTime=0}randomFrom(o){return o[Math.floor(Math.random()*o.length)]}static#o=a=()=>(this.\u0275fac=function(i){return new(i||n)(s.rXU(W),s.rXU(j.D))},this.\u0275cmp=s.VBU({type:n,selectors:[["app-workbook"]],viewQuery:function(i,t){if(1&i&&s.GBs(N,5),2&i){let c;s.mGM(c=s.lsd())&&(t.canvasRef=c.first)}},decls:11,vars:10,consts:[["canvas",""],[1,"workbook-content",3,"fullscreen","scrollY"],[1,"prompt-bar"],["color","light"],[1,"prompt-text"],[1,"canvas-wrapper"],["class","drawing-canvas",4,"ngIf"],["class","undo-btn","fill","clear",3,"click",4,"ngIf"],["class","caught-up-box",4,"ngIf"],["class","check-btn","color","primary",3,"disabled","click",4,"ngIf"],["class","results-overlay",3,"click",4,"ngIf"],[1,"drawing-canvas"],["fill","clear",1,"undo-btn",3,"click"],["name","backspace"],[1,"caught-up-box"],[1,"caught-up-title"],[1,"caught-up-message"],["color","primary",1,"check-btn",3,"click","disabled"],["name","crescent",4,"ngIf"],[4,"ngIf"],["name","crescent"],[1,"results-overlay",3,"click"],[1,"results-card",3,"click"],[1,"status-display"],[1,"feedback"],[1,"stroke-info"],["class","matches-section",4,"ngIf"],["expand","block",3,"click"],[1,"matches-section"],[1,"matches-title"],[1,"matches-list"],["class","match-item",4,"ngFor","ngForOf"],[1,"match-item"],[1,"match-char"]],template:function(i,t){1&i&&(s.j41(0,"ion-content",1)(1,"div",2),s.nrm(2,"ion-menu-button",3),s.j41(3,"span",4),s.EFF(4),s.k0s()(),s.j41(5,"div",5),s.DNE(6,G,2,0,"canvas",6)(7,$,2,0,"ion-button",7)(8,Y,5,0,"div",8),s.k0s(),s.DNE(9,Q,3,3,"ion-button",9)(10,i1,13,9,"div",10),s.k0s()),2&i&&(s.Y8G("fullscreen",!0)("scrollY",!1),s.R7$(3),s.xc7("color",t.promptColor),s.R7$(),s.JRh(t.promptText),s.R7$(2),s.Y8G("ngIf",!t.noCardsAvailable),s.R7$(),s.Y8G("ngIf",!t.noCardsAvailable),s.R7$(),s.Y8G("ngIf",t.noCardsAvailable),s.R7$(),s.Y8G("ngIf",!t.noCardsAvailable),s.R7$(),s.Y8G("ngIf",t.showResults))},dependencies:[p.W9,p.MC,p.Jm,p.iq,p.w2,M.MD,M.Sq,M.bT],styles:[".workbook-content[_ngcontent-%COMP%]{--background: #000}.prompt-bar[_ngcontent-%COMP%]{display:flex;align-items:center;height:144px;background:#111;padding:0 8px}.prompt-text[_ngcontent-%COMP%]{flex:1;text-align:center;font-size:28px;color:#fff;margin-right:40px}.canvas-wrapper[_ngcontent-%COMP%]{position:absolute;inset:144px 0 0;background:#000}.drawing-canvas[_ngcontent-%COMP%]{width:100%;height:100%;touch-action:none;display:block}.undo-btn[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;--color: #666;--padding-start: 8px;--padding-end: 8px;font-size:24px}.results-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#000000e6;display:flex;align-items:center;justify-content:center;z-index:100}.results-card[_ngcontent-%COMP%]{background:#1a1a1a;border-radius:16px;padding:24px;min-width:280px;max-width:90%;text-align:center}.results-card.correct[_ngcontent-%COMP%]   .status-display[_ngcontent-%COMP%], .results-card.correct[_ngcontent-%COMP%]   .feedback[_ngcontent-%COMP%]{color:#e63946}.results-card.befuddled[_ngcontent-%COMP%]   .status-display[_ngcontent-%COMP%], .results-card.befuddled[_ngcontent-%COMP%]   .feedback[_ngcontent-%COMP%]{color:#f7b731}.results-card.wrong[_ngcontent-%COMP%]   .status-display[_ngcontent-%COMP%], .results-card.wrong[_ngcontent-%COMP%]   .feedback[_ngcontent-%COMP%]{color:#4a90d9}.status-display[_ngcontent-%COMP%]{font-size:64px;font-weight:700;margin-bottom:8px}.feedback[_ngcontent-%COMP%]{font-family:Shippori Mincho,serif;font-size:18px;margin-bottom:16px;white-space:pre-line}.stroke-info[_ngcontent-%COMP%]{font-size:14px;color:#888;margin-bottom:20px}.matches-section[_ngcontent-%COMP%]{border-top:1px solid #333;padding-top:16px;margin-bottom:20px}.matches-title[_ngcontent-%COMP%]{font-size:12px;color:#666;text-transform:uppercase;letter-spacing:1px;margin-bottom:12px}.matches-list[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:16px}.match-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.match-char[_ngcontent-%COMP%]{font-size:32px;color:#fff}.check-btn[_ngcontent-%COMP%]{position:absolute;bottom:32px;left:50%;transform:translate(-50%);--background: #222;--background-hover: #333;--color: #fff;--border-radius: 32px;--padding-start: 12vw;--padding-end: 12vw;--padding-top: 16px;--padding-bottom: 16px;min-height:60px;font-family:Shippori Mincho,serif;font-size:clamp(20px,5vw,28px);font-weight:600;letter-spacing:2px}.results-card[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{font-family:Shippori Mincho,serif;font-weight:700}.caught-up-box[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:#1a1a1a;border-radius:16px;padding:32px;text-align:center;max-width:90%;width:320px}.caught-up-title[_ngcontent-%COMP%]{font-size:36px;margin-bottom:16px}.caught-up-message[_ngcontent-%COMP%]{font-size:16px;color:#ccc;line-height:1.5}"]}))}return a(),n})();const n1=[{path:"",component:O}];let t1=(()=>{var a;class n{static#o=a=()=>(this.\u0275fac=function(i){return new(i||n)},this.\u0275mod=s.$C({type:n}),this.\u0275inj=r.G2t({imports:[V.iI.forChild(n1),V.iI]}))}return a(),n})(),l1=(()=>{var a;class n{static#o=a=()=>(this.\u0275fac=function(i){return new(i||n)},this.\u0275mod=s.$C({type:n}),this.\u0275inj=r.G2t({imports:[M.MD,D.YN,R.bv,t1,O]}))}return a(),n})()}}]);