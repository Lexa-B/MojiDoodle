"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8126],{8126(G,S,x){x.d(S,{WorkbookPageModule:()=>N});var k,M=x(2200),j=x(4341),O=x(7343),L=x(8132),u=x(3112),V=function(a,n){var l=function(){if(typeof window>"u")return new Map;if(!k){var a=window;a.Ionicons=a.Ionicons||{},k=a.Ionicons.map=a.Ionicons.map||new Map}return k}(),o=l.get(a);void 0===o?l.set(a,n):o!==n&&console.warn('[Ionicons Warning]: Multiple icons were mapped to name "'.concat(a,'". Ensure that multiple icons are not mapped to the same icon name.'))},s=x(3664),w=x(2615);let P=(()=>{var a;class n{constructor(){this.characters=[{character:"\u3042",strokeCount:3,strokes:[[{x:.2,y:.25},{x:.8,y:.25}],[{x:.5,y:.15},{x:.45,y:.4},{x:.3,y:.6},{x:.2,y:.8}],[{x:.4,y:.45},{x:.6,y:.5},{x:.75,y:.65},{x:.65,y:.8},{x:.45,y:.75},{x:.5,y:.55}]]},{character:"\u3044",strokeCount:2,strokes:[[{x:.3,y:.2},{x:.25,y:.5},{x:.3,y:.8}],[{x:.7,y:.3},{x:.65,y:.6},{x:.7,y:.85}]]},{character:"\u3046",strokeCount:2,strokes:[[{x:.4,y:.2},{x:.6,y:.2}],[{x:.5,y:.35},{x:.55,y:.5},{x:.45,y:.7},{x:.5,y:.85}]]},{character:"\u3048",strokeCount:2,strokes:[[{x:.35,y:.25},{x:.65,y:.25}],[{x:.3,y:.4},{x:.5,y:.35},{x:.7,y:.5},{x:.4,y:.7},{x:.6,y:.85}]]},{character:"\u304a",strokeCount:3,strokes:[[{x:.2,y:.3},{x:.75,y:.3}],[{x:.4,y:.15},{x:.35,y:.5},{x:.25,y:.85}],[{x:.5,y:.5},{x:.7,y:.55},{x:.7,y:.75},{x:.5,y:.8},{x:.55,y:.6}]]}]}recognize(o,i,t){const e=this.normalizeStrokes(o,i,t),c=[];for(const r of this.characters){const v=this.compareStrokes(e,r);c.push({character:r.character,score:v})}return c.sort((r,v)=>v.score-r.score),c}getExpectedStrokeCount(o){return this.characters.find(t=>t.character===o)?.strokeCount??0}normalizeStrokes(o,i,t){if(0===o.length)return[];let e=1/0,c=1/0,r=-1/0,v=-1/0;for(const p of o)for(const m of p)e=Math.min(e,m.x),c=Math.min(c,m.y),r=Math.max(r,m.x),v=Math.max(v,m.y);const d=Math.max(r-e||1,v-c||1);return o.map(p=>p.map(m=>({x:(m.x-e)/d,y:(m.y-c)/d})))}compareStrokes(o,i){let t=0;const e=Math.abs(o.length-i.strokeCount);if(t+=.3*Math.max(0,100-25*e),e>2)return.5*t;const r=Math.min(o.length,i.strokes.length);let v=0;for(let g=0;g<r;g++)v+=this.compareStroke(o[g],i.strokes[g]);return r>0&&(v/=r),t+=.7*v,Math.round(t)}compareStroke(o,i){const e=this.resampleStroke(o,20),c=this.resampleStroke(i,20);let r=0;for(let h=0;h<20;h++){const d=e[h].x-c[h].x,p=e[h].y-c[h].y;r+=Math.sqrt(d*d+p*p)}return Math.max(0,100-r/20*150)}resampleStroke(o,i){if(0===o.length)return Array(i).fill({x:.5,y:.5});if(1===o.length)return Array(i).fill(o[0]);let t=0;for(let g=1;g<o.length;g++){const h=o[g].x-o[g-1].x,d=o[g].y-o[g-1].y;t+=Math.sqrt(h*h+d*d)}if(0===t)return Array(i).fill(o[0]);const e=t/(i-1),c=[o[0]];let r=0,v=1;for(let g=1;g<i-1;g++){const h=g*e;for(;v<o.length&&r<h;){const d=o[v].x-o[v-1].x,p=o[v].y-o[v-1].y,m=Math.sqrt(d*d+p*p);if(r+m>=h){const y=(h-r)/m;c.push({x:o[v-1].x+d*y,y:o[v-1].y+p*y});break}r+=m,v++}c.length<=g&&c.push(o[o.length-1])}return c.push(o[o.length-1]),c}static#o=a=()=>(this.\u0275fac=function(i){return new(i||n)},this.\u0275prov=w.jDH({token:n,factory:n.\u0275fac,providedIn:"root"}))}return a(),n})();const R=["canvas"];function _(a,n){1&a&&s.nrm(0,"ion-spinner",13)}function T(a,n){1&a&&(s.j41(0,"span"),s.EFF(1,"CHECK!"),s.k0s())}function U(a,n){if(1&a&&(s.j41(0,"div",26)(1,"span",27),s.EFF(2),s.k0s(),s.j41(3,"span",28),s.EFF(4),s.k0s()()),2&a){const l=n.$implicit;s.R7$(2),s.JRh(l.character),s.R7$(2),s.SpI("",l.score,"%")}}function E(a,n){if(1&a){const l=s.RV6();s.j41(0,"div",14),s.bIt("click",function(){w.eBV(l);const i=s.XpG();return w.Njj(i.dismissResults())}),s.j41(1,"div",15),s.bIt("click",function(i){return w.eBV(l),w.Njj(i.stopPropagation())}),s.j41(2,"div",16)(3,"div",17),s.EFF(4),s.k0s(),s.j41(5,"div",18),s.EFF(6,"/ 100"),s.k0s()(),s.j41(7,"div",19),s.EFF(8),s.k0s(),s.j41(9,"div",20),s.EFF(10),s.k0s(),s.j41(11,"div",21)(12,"div",22),s.EFF(13,"Closest matches:"),s.k0s(),s.j41(14,"div",23),s.DNE(15,U,5,2,"div",24),s.k0s()(),s.j41(16,"ion-button",25),s.bIt("click",function(){w.eBV(l);const i=s.XpG();return w.Njj(i.dismissResults())}),s.EFF(17,"OK"),s.k0s()()()}if(2&a){const l=s.XpG();s.R7$(4),s.JRh(l.resultScore),s.R7$(4),s.JRh(l.resultFeedback),s.R7$(2),s.JRh(l.strokeCountInfo),s.R7$(5),s.Y8G("ngForOf",l.topMatches)}}let A=(()=>{var a;class n{constructor(o){this.strokeRecognition=o,this.isDrawing=!1,this.strokes=[],this.currentStroke=[],this.currentCharacter="\u3042",this.promptText="A (Hiragana)",this.isChecking=!1,this.showResults=!1,this.resultScore=0,this.resultFeedback="",this.strokeCountInfo="",this.topMatches=[],function(a){Object.keys(a).forEach(function(n){V(n,a[n]);var l=n.replace(/([a-z0-9]|(?=[A-Z]))([A-Z0-9])/g,"$1-$2").toLowerCase();n!==l&&V(l,a[n])})}({backspace:"data:image/svg+xml;utf8,<svg xmlns='http://www.w3.org/2000/svg' class='ionicon' viewBox='0 0 512 512'><path d='M403.13 96H156.87a44.9 44.9 0 00-33.68 15.27 15.88 15.88 0 00-1.91 2.7L32 247.75a16 16 0 000 16.5l89.15 133.57a16.24 16.24 0 002 2.88 44.89 44.89 0 0033.7 15.3h246.28A44.92 44.92 0 00448 371.13V140.87A44.92 44.92 0 00403.13 96zM348 311a16 16 0 11-22.63 22.62L271.67 280 218 333.65A16 16 0 01195.35 311L249 257.33l-53.69-53.69A16 16 0 01218 181l53.69 53.7 53.67-53.7A16 16 0 01348 203.64l-53.7 53.69z'/></svg>"})}ngOnInit(){}ngAfterViewInit(){setTimeout(()=>this.setupCanvas(),100)}ngOnDestroy(){this.resizeObserver&&this.resizeObserver.disconnect()}setupCanvas(){const o=this.canvasRef.nativeElement,i=o.parentElement;i&&(this.resizeCanvas(),this.resizeObserver=new ResizeObserver(()=>this.resizeCanvas()),this.resizeObserver.observe(i),this.ctx=o.getContext("2d"),this.setCanvasStyle(),o.addEventListener("mousedown",this.handleMouseDown.bind(this)),o.addEventListener("mousemove",this.handleMouseMove.bind(this)),o.addEventListener("mouseup",this.handleMouseUp.bind(this)),o.addEventListener("mouseleave",this.handleMouseUp.bind(this)),o.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),o.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),o.addEventListener("touchend",this.handleTouchEnd.bind(this)))}resizeCanvas(){const o=this.canvasRef.nativeElement,i=o.parentElement;i&&(o.width=i.clientWidth,o.height=i.clientHeight,this.ctx&&this.setCanvasStyle())}setCanvasStyle(){this.ctx.strokeStyle="#fff",this.ctx.lineWidth=4,this.ctx.lineCap="round",this.ctx.lineJoin="round"}handleMouseDown(o){this.isDrawing=!0;const i=this.getMousePos(o);this.currentStroke=[i],this.ctx.beginPath(),this.ctx.moveTo(i.x,i.y)}handleMouseMove(o){if(!this.isDrawing)return;const i=this.getMousePos(o);this.currentStroke.push(i),this.ctx.lineTo(i.x,i.y),this.ctx.stroke()}handleMouseUp(){this.isDrawing&&this.currentStroke.length>0&&(this.strokes.push([...this.currentStroke]),this.currentStroke=[]),this.isDrawing=!1}handleTouchStart(o){o.preventDefault(),this.isDrawing=!0;const i=this.getTouchPos(o);this.currentStroke=[i],this.ctx.beginPath(),this.ctx.moveTo(i.x,i.y)}handleTouchMove(o){if(!this.isDrawing)return;o.preventDefault();const i=this.getTouchPos(o);this.currentStroke.push(i),this.ctx.lineTo(i.x,i.y),this.ctx.stroke()}handleTouchEnd(){this.isDrawing&&this.currentStroke.length>0&&(this.strokes.push([...this.currentStroke]),this.currentStroke=[]),this.isDrawing=!1}getMousePos(o){const i=this.canvasRef.nativeElement,t=i.getBoundingClientRect();return{x:i.width/t.width*(o.clientX-t.left),y:i.height/t.height*(o.clientY-t.top)}}getTouchPos(o){const i=this.canvasRef.nativeElement,t=i.getBoundingClientRect();return{x:i.width/t.width*(o.touches[0].clientX-t.left),y:i.height/t.height*(o.touches[0].clientY-t.top)}}onCheck(){0!==this.strokes.length&&(this.isChecking=!0,setTimeout(()=>{const o=this.canvasRef.nativeElement,i=this.strokeRecognition.recognize(this.strokes,o.width,o.height),t=i.find(c=>c.character===this.currentCharacter);this.resultScore=t?.score??0;const e=this.strokeRecognition.getExpectedStrokeCount(this.currentCharacter);this.strokeCountInfo=`Strokes: ${this.strokes.length}/${e}`,this.resultFeedback=this.resultScore>=80?"\u7d20\u6674\u3089\u3057\u3044! (Excellent!)":this.resultScore>=60?"\u3044\u3044\u306d! (Good!)":this.resultScore>=40?"\u3082\u3046\u5c11\u3057 (Almost!)":"\u3082\u3046\u4e00\u5ea6 (Try again!)",this.topMatches=i.slice(0,3),this.isChecking=!1,this.showResults=!0},100))}dismissResults(){this.showResults=!1}onUndo(){this.strokes.length>0&&(this.strokes.pop(),this.redrawStrokes())}redrawStrokes(){const o=this.canvasRef.nativeElement;this.ctx.clearRect(0,0,o.width,o.height),this.setCanvasStyle();for(const i of this.strokes)if(!(i.length<2)){this.ctx.beginPath(),this.ctx.moveTo(i[0].x,i[0].y);for(let t=1;t<i.length;t++)this.ctx.lineTo(i[t].x,i[t].y);this.ctx.stroke()}}clearCanvas(){const o=this.canvasRef.nativeElement;this.ctx.clearRect(0,0,o.width,o.height),this.strokes=[]}static#o=a=()=>(this.\u0275fac=function(i){return new(i||n)(s.rXU(P))},this.\u0275cmp=s.VBU({type:n,selectors:[["app-workbook"]],viewQuery:function(i,t){if(1&i&&s.GBs(R,5),2&i){let e;s.mGM(e=s.lsd())&&(t.canvasRef=e.first)}},decls:14,vars:7,consts:[["canvas",""],[1,"workbook-content",3,"fullscreen","scrollY"],[1,"prompt-bar"],["color","light"],[1,"prompt-text"],[1,"canvas-wrapper"],[1,"drawing-canvas"],["fill","clear",1,"undo-btn",3,"click"],["name","backspace"],[1,"check-btn",3,"click","disabled"],["name","crescent",4,"ngIf"],[4,"ngIf"],["class","results-overlay",3,"click",4,"ngIf"],["name","crescent"],[1,"results-overlay",3,"click"],[1,"results-card",3,"click"],[1,"score-display"],[1,"score-number"],[1,"score-label"],[1,"feedback"],[1,"stroke-info"],[1,"matches-section"],[1,"matches-title"],[1,"matches-list"],["class","match-item",4,"ngFor","ngForOf"],["expand","block",3,"click"],[1,"match-item"],[1,"match-char"],[1,"match-score"]],template:function(i,t){if(1&i){const e=s.RV6();s.j41(0,"ion-content",1)(1,"div",2),s.nrm(2,"ion-menu-button",3),s.j41(3,"span",4),s.EFF(4),s.k0s()(),s.j41(5,"div",5),s.nrm(6,"canvas",6,0),s.j41(8,"ion-button",7),s.bIt("click",function(){return w.eBV(e),w.Njj(t.onUndo())}),s.nrm(9,"ion-icon",8),s.k0s()(),s.j41(10,"ion-button",9),s.bIt("click",function(){return w.eBV(e),w.Njj(t.onCheck())}),s.DNE(11,_,1,0,"ion-spinner",10)(12,T,2,0,"span",11),s.k0s(),s.DNE(13,E,18,4,"div",12),s.k0s()}2&i&&(s.Y8G("fullscreen",!0)("scrollY",!1),s.R7$(4),s.JRh(t.promptText),s.R7$(6),s.Y8G("disabled",t.isChecking),s.R7$(),s.Y8G("ngIf",t.isChecking),s.R7$(),s.Y8G("ngIf",!t.isChecking),s.R7$(),s.Y8G("ngIf",t.showResults))},dependencies:[u.W9,u.MC,u.Jm,u.iq,u.w2,M.MD,M.Sq,M.bT],styles:[".workbook-content[_ngcontent-%COMP%]{--background: #000}.prompt-bar[_ngcontent-%COMP%]{display:flex;align-items:center;height:48px;background:#111;padding:0 8px}.prompt-text[_ngcontent-%COMP%]{flex:1;text-align:center;font-size:28px;color:#fff;margin-right:40px}.canvas-wrapper[_ngcontent-%COMP%]{position:absolute;inset:48px 0 0;background:#000}.drawing-canvas[_ngcontent-%COMP%]{width:100%;height:100%;touch-action:none;display:block}.undo-btn[_ngcontent-%COMP%]{position:absolute;top:8px;right:8px;--color: #666;--padding-start: 8px;--padding-end: 8px;font-size:24px}.results-overlay[_ngcontent-%COMP%]{position:absolute;inset:0;background:#000000e6;display:flex;align-items:center;justify-content:center;z-index:100}.results-card[_ngcontent-%COMP%]{background:#1a1a1a;border-radius:16px;padding:24px;min-width:280px;max-width:90%;text-align:center}.score-display[_ngcontent-%COMP%]{display:flex;align-items:baseline;justify-content:center;margin-bottom:8px}.score-number[_ngcontent-%COMP%]{font-size:72px;font-weight:700;color:#fff}.score-label[_ngcontent-%COMP%]{font-size:24px;color:#666;margin-left:4px}.feedback[_ngcontent-%COMP%]{font-size:20px;color:#4ecdc4;margin-bottom:16px}.stroke-info[_ngcontent-%COMP%]{font-size:14px;color:#888;margin-bottom:20px}.matches-section[_ngcontent-%COMP%]{border-top:1px solid #333;padding-top:16px;margin-bottom:20px}.matches-title[_ngcontent-%COMP%]{font-size:12px;color:#666;text-transform:uppercase;letter-spacing:1px;margin-bottom:12px}.matches-list[_ngcontent-%COMP%]{display:flex;justify-content:center;gap:16px}.match-item[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.match-char[_ngcontent-%COMP%]{font-size:32px;color:#fff}.match-score[_ngcontent-%COMP%]{font-size:12px;color:#888}.check-btn[_ngcontent-%COMP%]{position:absolute;bottom:32px;left:50%;transform:translate(-50%);--background: #222;--background-hover: #333;--color: #fff;--border-radius: 32px;--padding-start: 12vw;--padding-end: 12vw;--padding-top: 16px;--padding-bottom: 16px;min-height:60px;font-size:clamp(20px,5vw,28px);font-weight:600;letter-spacing:2px}"]}))}return a(),n})();const I=[{path:"",component:A}];let W=(()=>{var a;class n{static#o=a=()=>(this.\u0275fac=function(i){return new(i||n)},this.\u0275mod=s.$C({type:n}),this.\u0275inj=w.G2t({imports:[L.iI.forChild(I),L.iI]}))}return a(),n})(),N=(()=>{var a;class n{static#o=a=()=>(this.\u0275fac=function(i){return new(i||n)},this.\u0275mod=s.$C({type:n}),this.\u0275inj=w.G2t({imports:[M.MD,j.YN,O.bv,W,A]}))}return a(),n})()}}]);